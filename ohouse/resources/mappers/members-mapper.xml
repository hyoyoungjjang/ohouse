<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="membersMapper">
  	<resultMap id="membersResultSet" type="Members">
  		<result column="MEMBERS_NO" property="membersNo" />
  		<result column="MEMBERS_ID" property="membersId" />
  		<result column="MEMBERS_PWD" property="membersPwd" />
  		<result column="MEMBERS_NAME" property="membersName" />
  		<result column="MEMBERS_BIRTH" property="membersBirth" />
  		<result column="MEMBERS_PHONE" property="membersPhone" />
  		<result column="MEMBERS_EMAIL" property="membersEmail" />
  		<result column="GENDER" property="gender" />
  		<result column="MEMBERS_TYPE" property="membersType" />
  		<result column="COMPANY_NAME" property="companyName" />
  		<result column="REPRESENTATATIVE" property="representative" />
  		<result column="COMPANY_PLACE" property="companyPlace" />
  		<result column="COMPANY_PHONE" property="companyPhone" />
  		<result column="COMPANY_EMAIL" property="companyEmail" />
  		<result column="REG_NUM" property="regNum" />
  		<result column="MEMBERS_ENROLL_TIME" property="membersEnrollTime" />
  		<result column="MEMBERS_MODIFY_TIME" property="membersModifyTime" />
  		<result column="MEMBERS_STATUS" property="membersStatus" />
  	</resultMap>
  	<resultMap id="mediaResultSet" type="Media">
  		<result column="MEDIA_ID" property="mediaId"/>
  		<result column="MEMBERS_NO" property="mediaMembersNo"/>
  		<result column="MEDIA_TYPE" property="mediaType"/>
  		<result column="ORIGIN_NAME" property="originName"/>
  		<result column="CHANGE_NAME" property="changeName"/>
  		<result column="FILE_PATH" property="filePath"/>
  		<result column="FILE_LEVEL" property="fileLevel"/>
  		<result column="UPLOAD_DATE" property="uploadDate"/>
  		<result column="MEDIA_STATUS" property="mediaStatus"/>
  	</resultMap>
  	 <select id="loginMembers" resultMap="membersResultSet" parameterType="Members">
  	SELECT
		    MEMBERS_NO
			,MEMBERS_ID
			,MEMBERS_PWD
			,MEMBERS_NAME
			,MEMBERS_BIRTH
			,MEMBERS_PHONE
			,MEMBERS_EMAIL
			,GENDER
			,MEMBERS_TYPE
			,COMPANY_NAME
			,REPRESENTATATIVE
			,COMPANY_PLACE
			,COMPANY_PHONE
			,COMPANY_EMAIL
			,REG_NUM
			,MEMBERS_ENROLL_TIME
			,MEMBERS_MODIFY_TIME
			,MEMBERS_STATUS
		FROM MEMBERS
		WHERE MEMBERS_ID = #{membersId}
		AND MEMBERS_PWD = #{membersPwd}
		AND MEMBERS_STATUS = 'Y'
  </select>
  
  <select id="selectMembers" resultMap="membersResultSet" >
	  SELECT
		 MEMBERS_NO
		,MEMBERS_ID
		,MEMBERS_PWD
		,MEMBERS_NAME
		,MEMBERS_BIRTH
		,MEMBERS_PHONE
		,MEMBERS_EMAIL
		,GENDER
		,MEMBERS_TYPE
		,COMPANY_NAME
		,REPRESENTATATIVE
		,COMPANY_PLACE
		,COMPANY_PHONE
		,COMPANY_EMAIL
		,REG_NUM
		,MEMBERS_STATUS
	FROM MEMBERS
	WHERE MEMBERS_ID = #{membersId}
	    AND MEMBERS_STATUS = 'Y'
  </select>
  
  <insert id="insertMembers" parameterType="Members">
  INSERT INTO MEMBERS
		(
			MEMBERS_NO
			,MEMBERS_ID
			,MEMBERS_PWD
			,MEMBERS_NAME
			,MEMBERS_BIRTH
			,MEMBERS_PHONE
			,MEMBERS_EMAIL
			,GENDER
		)
		VALUES
		(
			SEQ_MEMID.NEXTVAL,
			#{membersId},
			#{membersPwd},
			#{membersName},
			#{membersBirth},
			#{membersPhone},
			#{membersEmail},
			#{gender}
		)
  </insert>
  
  <update id="updateMembers" parameterType="Members">
 	UPDATE MEMBERS
	SET MEMBERS_NAME = #{membersName}
		, MEMBERS_PWD = #{membersPwd}
		, MEMBERS_PHONE = #{membersPhone}
		, MEMBERS_EMAIL = #{membersEmail}
		, MEMBERS_BIRTH = #{membersBirth}
		, MEMBERS_MODIFY_TIME = SYSDATE
	WHERE MEMBERS_ID = #{membersId}
  </update>
  <update id="updatePwdMembers" parameterType="Members">
  	UPDATE MEMBERS
  	SET MEMBERS_PWD = #{memberPwd},
		MEMBERS_MODIFY_TIME = SYSDATE
	WHERE MEMBERS_ID = #{membersId}
	 AND MEMBERS_PWD = #{membersPwd}
  </update>
  <update id="deleteMembers" parameterType="Media">
  	UPDATE MEMBERS
	SET MEMBERS_STATUS = 'N'
		,MEMBERS_MODIFY_TIME = SYSDATE
	WHERE MEMBERS_ID = #{membersId}
	  AND MEMBERS_PWD = #{membersPwd}
  </update>
  <insert id="insertProfile" parameterType="Media">
 	INSERT
	INTO MEDIA
	(
		MEDIA_ID,
		MEMBERS_NO,
		MEDIA_TYPE,
		ORIGIN_NAME,
		CHANGE_NAME,
		FILE_PATH,
		FILE_LEVEL
	)
	VALUES
	(
		SEQ_MEDID.NEXTVAL,
		SEQ_MEMID.CURRVAL,
		1,
		#{origin_name},
		#{change_name},
		#{filePath},
		3
	)
  </insert>
  <select id="selectProfile" resultMap="mediaResultSet">
  SELECT
	  MEDIA_ID,
	  FILE_PATH
  FROM MEDIA
  WHERE MEMBERS_NO = #{mediaMembersNo}
   AND MEDIA_STATUS = 'Y'
  </select>
  <update id="updateProfile" parameterType="Media">
  UPDATE MEDIA
	SET ORIGIN_NAME = #{originName},
		CHANGE_NAME = #{changeName},
		FILE_PATH = #{filePath}
	WHERE MEDIA_ID = #{mediaId}
  </update>
  <!-- 
  <entry key="updateProfile">
		UPDATE MEDIA
		SET ORIGIN_NAME = ?,
			CHANGE_NAME = ?,
			FILE_PATH = ?
		WHERE MEDIA_ID = ?
	</entry>
	<entry key="deleteProfile">
		UPDATE MEDIA
		SET MEDIA_STATUS = 'N'
		WHERE MEDIA_ID = ?
	</entry>
	<entry key="selectMyProductScrapCount">
	SELECT COUNT(*)
	FROM SCRAP
	WHERE MEMBERS_NO = ?
	AND SCRAP_TYPE = 1
	AND SCRAP_STATUS = 'Y'
	</entry>
	<entry key="selectMyMediaScrapCount">
	SELECT COUNT(*)
	FROM SCRAP
	WHERE MEMBERS_NO = ?
	AND SCRAP_TYPE = 2
	AND SCRAP_STATUS = 'Y'
	</entry>
	<entry key="selectMyBoardScrapCount">
	SELECT COUNT(*)
	FROM SCRAP
	WHERE MEMBERS_NO = ?
	AND SCRAP_TYPE = 3
	AND SCRAP_STATUS = 'Y'
	</entry>
	<entry key="deleteScrap">
	UPDATE SCRAP
	SET SCRAP_STATUS = 'N"
	WHERE SCRAP_ID = ?
	</entry>
</properties>
   -->
  </mapper>